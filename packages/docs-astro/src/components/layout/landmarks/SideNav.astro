---
import { getCollection } from 'astro:content';
import { VerticalNav } from '@cmsgov/design-system';
import type { BasicCollection } from '../../../content/config';

const { pathname } = Astro.url;

// TODO: Need to just ask how to get proper types returned when using a union type in getCollection
async function getPages(collectionName: BasicCollection) {
  const gettingStartedPages: any[] = await getCollection(collectionName);
  const gettingStartedItems = gettingStartedPages.map((page) => ({
    label: page.data.title,
    selected: pathname.includes(`getting-started/${page.slug}`),
    url: `/getting-started/${page.slug}`,
  }));
}

const blogPages = await getCollection('blog');
const blogItems = blogPages.map((page) => ({
  label: page.data.title,
  selected: pathname.includes(`blog/${page.slug}`),
  url: `/blog/${page.slug}`,
}));

const gettingStartedPages = await getCollection('getting-started');
const gettingStartedItems = gettingStartedPages.map((page) => ({
  label: page.data.title,
  selected: pathname.includes(`getting-started/${page.slug}`),
  url: `/getting-started/${page.slug}`,
}));

const navItems = [
  {
    label: "Blog (Test content)",
    selected: blogItems.some(item => item.selected),
    items: blogItems,
  },
  {
    label: "Getting Started",
    selected: gettingStartedItems.some(item => item.selected),
    items: gettingStartedItems,
  }
];
---

<div class="ds-u-padding--0 ds-u-md-padding--2 ds-u-md-padding-top--4 c-navigation">
  <div class="ds-u-padding--2 ds-u-md-padding--0">
    <VerticalNav
      className="c-navigation__link-list"
      items={navItems}
      client:load
    />
  </div>
</div>
